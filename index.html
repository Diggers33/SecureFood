<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SecureFood Digital Twin Platform | IRIS Technology Solutions</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        /* Existing styles... (same as before, but with additions) */

        /* Updated Styles for Improvements */

        .tab-button.active {
            background: #ffffff;
            color: #2563eb;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            position: relative; /* For the data freshness indicator */
        }

        .tab-button.active::after {
            content: '';
            position: absolute;
            top: 4px;
            right: 4px;
            width: 8px;
            height: 8px;
            background-color: #10b981; /* Green for fresh data */
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .digital-twin-viewer {
            /* ... existing styles ... */
            cursor: grab; /* Change cursor on hover for interactivity */
        }

        .digital-twin-viewer:active {
            cursor: grabbing;
        }

        .alert-item {
            /* ... existing styles ... */
            border-left: 4px solid transparent; /* Alert severity indicator */
        }

        .alert-critical {
            /* ... existing styles ... */
            border-left-color: #dc2626;
        }

        .alert-warning {
            /* ... existing styles ... */
            border-left-color: #f59e0b;
        }

        .alert-info {
            /* ... existing styles ... */
            border-left-color: #2563eb;
        }

        .drilldown-link {
            color: #2563eb;
            text-decoration: underline;
            cursor: pointer;
            font-size: 13px;
            margin-top: 8px;
            display: block;
        }

        .help-icon {
            position: absolute;
            top: 16px;
            right: 16px;
            font-size: 20px;
            color: #9ca3af;
            cursor: pointer;
        }

        .help-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }

        .help-modal-content {
            background: white;
            padding: 32px;
            border-radius: 8px;
            max-width: 600px;
        }

        /* Accessibility improvements (example) */
        input:focus, select:focus, button:focus {
            outline: 2px solid #2563eb;
            outline-offset: 2px;
        }

    </style>
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="spinner"></div>
            <h3>Initializing Digital Twin Platform</h3>
            <p>Synchronizing real-time data streams...</p>
        </div>
    </div>

    <header class="platform-header">
        <div class="platform-logo">
            <img src="securefood-logo.png" alt="SecureFood Logo" class="full-logo-image">
            <div>
                <h1 class="platform-title">SecureFood Digital Twin Platform</h1>
                <p class="platform-subtitle">IRIS Technology Solutions | Enterprise Food System Intelligence</p>
            </div>
        </div>
        <div class="header-controls">
            <div class="status-indicator">
                <div class="status-dot"></div>
                <span>System Operational</span>
            </div>
            <button class="btn-primary" onclick="exportReport()">Export Report</button>
        </div>
        <i class="help-icon" onclick="showHelp()">?</i>
    </header>

    <div class="main-container">
        <nav class="tab-navigation">
            <button class="tab-button active" onclick="switchTab(event, 'dashboard')">
                Dashboard
            </button>
            <button class="tab-button" onclick="switchTab(event, 'analytics')">
                Analytics
            </button>
            <button class="tab-button" onclick="switchTab(event, 'alerts')">
                Alerts
            </button>
            <button class="tab-button" onclick="switchTab(event, 'settings')">
                Settings
            </button>
        </nav>

        <div id="dashboard" class="tab-content active">
            <div class="dashboard-grid">
                <div class="main-content">
                    <div class="kpi-grid">
                        <div class="kpi-card">
                            <div class="kpi-title">Supply Chain Efficiency</div>
                            <div class="kpi-value" id="efficiency-metric">94.2%</div>
                            <div class="kpi-change change-positive">
                                ↗ +2.1% vs. last month
                            </div>
                            <a class="drilldown-link" onclick="showEfficiencyDetails()">View Details</a>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-title">Risk Assessment Score</div>
                            <div class="kpi-value" id="risk-metric">7.3</div>
                            <div class="kpi-change change-positive">
                                ↗ +0.4 (Lower risk)
                            </div>
                             <a class="drilldown-link" onclick="showRiskDetails()">View Details</a>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-title">Predictive Accuracy</div>
                            <div class="kpi-value" id="prediction-metric">91.8%</div>
                            <div class="kpi-change change-positive">
                                ↗ +1.2% model improvement
                            </div>
                             <a class="drilldown-link" onclick="showPredictionDetails()">View Details</a>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-title">Cost Optimization</div>
                            <div class="kpi-value" id="cost-metric">€2.4M</div>
                            <div class="kpi-change change-positive">
                                ↗ €340K saved this quarter
                            </div>
                             <a class="drilldown-link" onclick="showCostDetails()">View Details</a>
                        </div>
                    </div>

                    <div class="digital-twin-viewer">
                        <div class="viewer-header">
                            <div class="viewer-title">Digital Twin Visualization - Supply Chain Network</div>
                            <div class="viewer-controls">
                                <button class="viewer-btn active" onclick="setViewMode('network')">Network</button>
                                <button class="viewer-btn" onclick="setViewMode('flow')">Flow</button>
                                <button class="viewer-btn" onclick="setViewMode('risk')">Risk</button>
                                <button class="viewer-btn" onclick="resetCamera()">Reset</button>
                            </div>
                        </div>
                        <div id="threejs-container"></div>
                    </div>
                </div>

                <div class="sidebar">
                    <div class="sidebar-card">
                        <h3 class="sidebar-title">System Metrics</h3>
                        <div class="metric-item">
                            <div class="metric-label">Data Accuracy</div>
                            <div class="metric-value">99.7%</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">Sync Latency</div>
                            <div class="metric-value">23ms</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">Active Sensors</div>
                            <div class="metric-value">1,247</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">System Load</div>
                            <div class="metric-value">34%</div>
                        </div>
                    </div>

                    <div class="sidebar-card">
                        <h3 class="sidebar-title">Supply Chain Controls</h3>
                        <div class="control-section">
                            <label class="control-label">Active Supply Chain</label>
                            <select class="control-select" id="chainSelector" onchange="switchSupplyChain()">
                                <option value="grain">Ukrainian Grain Network</option>
                                <option value="dairy">EU Dairy Systems</option>
                                <option value="fish">Mediterranean Aquaculture</option>
                                <option value="produce">Iberian Fresh Produce</option>
                            </select>
                        </div>
                        <div class="control-section">
                            <label class="control-label">Analysis Mode</label>
                            <select class="control-select" id="analysisMode">
                                <option value="realtime">Real-time Monitoring</option>
                                <option value="predictive">Predictive Analysis</option>
                                <option value="historical">Historical Trends</option>
                                <option value="stress">Stress Testing</option>
                            </select>
                        </div>
                        <button class="btn-secondary" onclick="runAnalysis()">Execute Analysis</button>
                        <button class="btn-secondary" onclick="runSimulation()">Run Scenario</button>
                        <button class="btn-secondary" onclick="generateInsights()">AI Insights</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="analytics" class="tab-content">
            <div class="analytics-layout">
                <div class="chart-card">
                    <div class="chart-title">Real-time Performance Metrics</div>
                    <div class="chart-container">
                        <canvas id="performanceChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <div class="chart-title">Risk Assessment Distribution</div>
                    <div class="chart-container">
                        <canvas id="riskChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <div class="chart-title">Supply Chain Throughput</div>
                    <div class="chart-container">
                        <canvas id="throughputChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <div class="chart-title">Cost Optimization Trends</div>
                    <div class="chart-container">
                        <canvas id="costChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <div id="alerts" class="tab-content">
            <div class="alerts-layout">
                <div class="alerts-list">
                    <div class="alerts-header">
                        <h3 class="alerts-title">System Alerts & Recommendations</h3>
                        <span class="alert-count" id="alertCount">3</span>
                    </div>
                    <div id="alertsContainer">
                        </div>
                </div>
                <div class="sidebar-card">
                    <h3 class="sidebar-title">Alert Filters</h3>
                    <div class="control-section">
                        <label class="control-label">Severity</label>
                        <select class="control-select" id="severityFilter" onchange="filterAlerts()">
                            <option value="all">All Levels</option>
                            <option value="critical">Critical Only</option>
                            <option value="warning">Warning & Above</option>
                        </select>
                    </div>
                    <div class="control-section">
                        <label class="control-label">Category</label>
                        <select class="control-select" id="categoryFilter" onchange="filterAlerts()">
                            <option value="all">All Categories</option>
                            <option value="performance">Performance</option>
                            <option value="security">Security</option>
                            <option value="maintenance">Maintenance</option>
                        </select>
                    </div>
                    <button class="btn-secondary" onclick="clearAlerts()">Clear All Alerts</button>
                    <button class="btn-secondary" onclick="exportAlerts()">Export Alerts</button>
                </div>
            </div>
        </div>

        <div id="settings" class="tab-content">
            <div class="settings-layout">
                <div class="settings-nav">
                    <div class="settings-nav-item active" onclick="switchSettingsTab(event, 'general')">General</div>
                    <div class="settings-nav-item" onclick="switchSettingsTab(event, 'integration')">Integration</div>
                    <div class="settings-nav-item" onclick="switchSettingsTab(event, 'notifications')">Notifications</div>
                    <div class="settings-nav-item" onclick="switchSettingsTab(event, 'security')">Security</div>
                    <div class="settings-nav-item" onclick="switchSettingsTab(event, 'advanced')">Advanced</div>
                </div>
                <div class="settings-content" id="settingsContent">
                    <div class="settings-section">
                        <h3 class="settings-section-title">General Configuration</h3>
                        <div class="form-group">
                            <label class="form-label">Platform Name</label>
                            <input type="text" class="form-input" value="SecureFood Digital Twin Platform">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Default Supply Chain</label>
                            <select class="form-input">
                                <option>Ukrainian Grain Network</option>
                                <option>EU Dairy Systems</option>
                                <option>Mediterranean Aquaculture</option>
                                <option>Iberian Fresh Produce</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Refresh Interval (seconds)</label>
                            <input type="number" class="form-input" value="5">
                        </div>
                        <button class="btn-primary">Save Changes</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="help-modal" id="helpModal">
        <div class="help-modal-content">
            <h2>SecureFood Digital Twin Platform - Help</h2>
            <p>Welcome to the SecureFood Digital Twin Platform. This platform provides real-time monitoring and analysis of your supply chain.</p>
            <h3>Dashboard</h3>
            <p>The dashboard provides key performance indicators (KPIs) and a visual representation of your supply chain network.</p>
            <ul>
                <li><strong>Supply Chain Efficiency:</strong> Current efficiency of your supply chain.</li>
                <li><strong>Risk Assessment Score:</strong> Current risk level in your supply chain (lower is better).</li>
                 <li><strong>Predictive Accuracy:</strong> Accuracy of the predictive models.</li>
                <li><strong>Cost Optimization:</strong> Total cost savings achieved.</li>
                <li><strong>Digital Twin Visualization:</strong> Interactive 3D visualization of your supply chain.  Use your mouse to drag and zoom.</li>
            </ul>
            <h3>Analytics</h3>
            <p>The analytics tab provides detailed charts and graphs for in-depth analysis.</p>
            <h3>Alerts</h3>
            <p>The alerts tab displays system alerts and recommendations.  Use the filters to narrow down the alerts.</p>
            <h3>Settings</h3>
            <p>The settings tab allows you to configure the platform.</p>
            <button class="btn-primary" onclick="hideHelp()">Close</button>
        </div>
    </div>

    <script>
        // Global variables
        let scene, camera, renderer, animationId;
        let supplyChainData = [];
        let performanceChart, riskChart, throughputChart, costChart;
        let digitalTwinEngine;
        let currentViewMode = 'network';
        let allAlerts = []; // Store all alerts for filtering

        // Tab switching functionality (same as before)
        function switchTab(evt, tabName) {
            // Hide all tab contents
            const tabContents = document.getElementsByClassName('tab-content');
            for (let i = 0; i < tabContents.length; i++) {
                tabContents[i].classList.remove('active');
            }

            // Remove active class from all tab buttons
            const tabButtons = document.getElementsByClassName('tab-button');
            for (let i = 0; i < tabButtons.length; i++) {
                tabButtons[i].classList.remove('active');
            }

            // Show the selected tab and mark button as active
            document.getElementById(tabName).classList.add('active');
            evt.currentTarget.classList.add('active');

            // Initialize charts if switching to analytics tab
            if (tabName === 'analytics' && !throughputChart) { // Check if any chart is not initialized
                setTimeout(initializeAnalyticsCharts, 100);
            }

            // Load alerts if switching to alerts tab
            if (tabName === 'alerts') {
                loadAlerts();
            }
        }

        function switchSettingsTab(evt, tabName) {
            // Remove active class from all settings nav items
            const navItems = document.querySelectorAll('.settings-nav-item');
            navItems.forEach(item => item.classList.remove('active'));
            
            // Add active class to clicked item
            evt.currentTarget.classList.add('active');

            // Update settings content based on tab
            updateSettingsContent(tabName);
        }

        function updateSettingsContent(tabName) {
            const content = document.getElementById('settingsContent');
            
            const contentMap = {
                general: `
                    <div class="settings-section">
                        <h3 class="settings-section-title">General Configuration</h3>
                        <div class="form-group">
                            <label class="form-label">Platform Name</label>
                            <input type="text" class="form-input" value="SecureFood Digital Twin Platform">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Default Supply Chain</label>
                            <select class="form-input">
                                <option>Ukrainian Grain Network</option>
                                <option>EU Dairy Systems</option>
                                <option>Mediterranean Aquaculture</option>
                                <option>Iberian Fresh Produce</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Refresh Interval (seconds)</label>
                            <input type="number" class="form-input" value="5">
                        </div>
                        <button class="btn-primary">Save Changes</button>
                    </div>
                `,
                integration: `
                    <div class="settings-section">
                        <h3 class="settings-section-title">SecureFood Ecosystem Integration</h3>
                        <div class="form-group">
                            <label class="form-label">Observatory Dashboard API</label>
                            <input type="url" class="form-input" value="https://api.securefood.eu/observatory">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Early Warning System Endpoint</label>
                            <input type="url" class="form-input" value="https://api.securefood.eu/alerts">
                        </div>
                        <div class="form-group">
                            <label class="form-label">RESILOG API Key</label>
                            <input type="password" class="form-input" value="sk-iris-dt-2024...">
                        </div>
                        <button class="btn-primary">Test Connections</button>
                    </div>
                `,
                notifications: `
                    <div class="settings-section">
                        <h3 class="settings-section-title">Notification Preferences</h3>
                        <div class="form-group">
                            <label class="form-label">Email Notifications</label>
                            <select class="form-input">
                                <option>All Alerts</option>
                                <option>Critical Only</option>
                                <option>Disabled</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">SMS Alerts</label>
                            <select class="form-input">
                                <option>Critical Only</option>
                                <option>Disabled</option>
                            </select>
                        </div>
                        <button class="btn-primary">Update Preferences</button>
                    </div>
                `,
                security: `
                    <div class="settings-section">
                        <h3 class="settings-section-title">Security Configuration</h3>
                        <div class="form-group">
                            <label class="form-label">Session Timeout (minutes)</label>
                            <input type="number" class="form-input" value="120">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Two-Factor Authentication</label>
                            <select class="form-input">
                                <option>Enabled</option>
                                <option>Disabled</option>
                            </select>
                        </div>
                        <button class="btn-primary">Apply Security Settings</button>
                    </div>
                `,
                advanced: `
                    <div class="settings-section">
                        <h3 class="settings-section-title">Advanced Settings</h3>
                        <div class="form-group">
                            <label class="form-label">Data Retention Period (days)</label>
                            <input type="number" class="form-input" value="365">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Performance Mode</label>
                            <select class="form-input">
                                <option>High Performance</option>
                                <option>Balanced</option>
                                <option>Power Saving</option>
                            </select>
                        </div>
                        <button class="btn-primary">Save Advanced Settings</button>
                    </div>
                `
            };

            content.innerHTML = contentMap[tabName] || contentMap.general;
        }

        // Digital Twin Engine Class (same as before)
        class DigitalTwinEngine {
            constructor() {
                this.metrics = {
                    efficiency: 94.2,
                    riskScore: 7.3,
                    accuracy: 91.8,
                    costSavings: 2.4
                };
                this.alertSystem = new AlertSystem();
            }

            initialize() {
                this.initializeDashboardCharts();
                this.startRealTimeUpdates();
                this.initializeAlerts();
            }

            initializeDashboardCharts() {
                // Performance Chart for Dashboard (will be created when analytics tab is opened)
                console.log('Digital Twin Engine initialized');
            }

            startRealTimeUpdates() {
                setInterval(() => {
                    this.updateMetrics();
                }, 5000);
            }

            updateMetrics() {
                // Simulate real-time metric updates
                const efficiencyChange = (Math.random() - 0.5) * 0.2;
                this.metrics.efficiency = Math.max(85, Math.min(100, this.metrics.efficiency + efficiencyChange));
                
                const riskChange = (Math.random() - 0.5) * 0.1;
                this.metrics.riskScore = Math.max(5, Math.min(10, this.metrics.riskScore + riskChange));
                
                // Update dashboard metrics
                document.getElementById('efficiency-metric').textContent = this.metrics.efficiency.toFixed(1) + '%';
                document.getElementById('risk-metric').textContent = this.metrics.riskScore.toFixed(1);
            }

            initializeAlerts() {
                // Initialize with some sample alerts
                this.alertSystem.addAlert('warning', 'Cold Chain Temperature Deviation', 
                    'Refrigerated transport RT-4429 experiencing +2°C above optimal range');
                this.alertSystem.addAlert('info', 'Route Optimization Available', 
                    'AI recommends alternative routing for grain shipments from Odessa port');
                this.alertSystem.addAlert('critical', 'Predictive Maintenance Alert', 
                    'Processing facility PF-12 shows 85% probability of equipment failure within 72 hours');
            }

            generateTimeLabels() {
                const labels = [];
                for (let i = 23; i >= 0; i--) {
                    const date = new Date();
                    date.setHours(date.getHours() - i);
                    labels.push(date.getHours().toString().padStart(2, '0') + ':00');
                }
                return labels;
            }

            generatePerformanceData() {
                const data = [];
                for (let i = 0; i < 24; i++) {
                    data.push(90 + Math.random() * 8 + Math.sin(i / 4) * 3);
                }
                return data;
            }
        }

        // Alert System Class (modified for filtering)
        class AlertSystem {
             constructor() {
                this.alerts = [];
                this.maxAlerts = 10;
            }

            addAlert(type, title, description) {
                const alert = {
                    id: Date.now(),
                    type: type,
                    title: title,
                    description: description,
                    timestamp: new Date()
                };

                this.alerts.unshift(alert);
                allAlerts.unshift(alert); // Store in allAlerts array

                if (this.alerts.length > this.maxAlerts) {
                    this.alerts.pop();
                    allAlerts.pop(); // Also remove from allAlerts
                }

                this.renderAlerts();
            }

            renderAlerts() {
                const container = document.getElementById('alertsContainer');
                if (!container) return;

                container.innerHTML = '';

                this.alerts.forEach(alert => {
                    const alertElement = document.createElement('div');
                    alertElement.className = 'alert-item';
                    alertElement.classList.add(`alert-${alert.type}`); // Add severity class

                    const iconMap = {
                        'critical': '!',
                        'warning': '⚠',
                        'info': 'i'
                    };

                    alertElement.innerHTML = `
                        <div class="alert-icon"><span class="math-inline">\{iconMap\[alert\.type\]\}</div\>
<div class\="alert\-content"\>
<div class\="alert\-title"\></span>{alert.title}</div>
                            <div class="alert-description"><span class="math-inline">\{alert\.description\}</div\>
</div\>
<div class\="alert\-time"\></span>{this.getTimeAgo(alert.timestamp)}</div>
                    `;

                    container.appendChild(alertElement);
                });

                // Update alert count
                const countElement = document.getElementById('alertCount');
                if (countElement) {
                    countElement.textContent = this.alerts.length;
                }
            }

            getTimeAgo(timestamp) {
                const now = new Date();
                const diff = Math.floor((now - timestamp) / 1000);
                
                if (diff < 60) return `${diff}s ago`;
                if (diff < 3600) return `${Math.floor(diff / 60)}m ago`;
                return `${Math.floor(diff / 3600)}h ago`;
            }

            filterAlerts() {
                const severityFilter = document.getElementById('severityFilter').value;
                const categoryFilter = document.getElementById('categoryFilter').value;

                this.alerts = allAlerts.filter(alert => {
                    let severityMatch = true;
                    if (severityFilter !== 'all') {
                        if (severityFilter === 'warning') {
                            severityMatch = alert.type === 'warning' || alert.type === 'critical';
                        } else {
                            severityMatch = alert.type === severityFilter;
                        }
                    }

                    let categoryMatch = true; // Placeholder for category filtering
                    // Add category filtering logic here when categories are added to alerts

                    return severityMatch && categoryMatch;
                });

                this.renderAlerts();
            }
        }

        // Initialize Analytics Charts (same as before)
        function initializeAnalyticsCharts() {
            // Helper to create gradient for charts
            function getGradient(ctx, chartArea, colorStart, colorEnd) {
                if (!chartArea) {
                    // This can happen if the chart is not yet rendered or has no dimensions
                    return null;
                }
                const gradient = ctx.createLinearGradient(0, chartArea.bottom, 0, chartArea.top);
                gradient.addColorStop(0, colorEnd);
                gradient.addColorStop(1, colorStart);
                return gradient;
            }

            // Performance Chart
            const perfCtx = document.getElementById('performanceChart');
            if (perfCtx) {
                // Destroy existing chart if it exists to prevent re-initialization issues
                if (performanceChart) {
                    performanceChart.destroy();
                }
                performanceChart = new Chart(perfCtx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: digitalTwinEngine.generateTimeLabels(),
                        datasets: [{
                            label: 'Efficiency',
                            data: digitalTwinEngine.generatePerformanceData(),
                            borderColor: '#2563eb',
                            backgroundColor: (context) => {
                                const chart = context.chart;
                                const { ctx, chartArea } = chart;
                                return getGradient(ctx, chartArea, 'rgba(37, 99, 235, 0.6)', 'rgba(37, 99, 235, 0)');
                            },
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4, // Smooth curve
                            pointRadius: 3,
                            pointHoverRadius: 6,
                            pointBackgroundColor: '#2563eb',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                mode: 'index',
                                intersect: false,
                                callbacks: {
                                    label: function(context) {
                                        return context.dataset.label + ': ' + context.parsed.y.toFixed(1) + '%';
                                    }
                                },
                                // Modern tooltip styling
                                backgroundColor: 'rgba(0,0,0,0.7)',
                                titleFont: { size: 14, weight: 'bold' },
                                bodyFont: { size: 14 },
                                padding: 10,
                                cornerRadius: 4
                            }
                        },
                        scales: {
                            x: {
                                grid: { 
                                    display: false 
                                },
                                ticks: {
                                    color: '#6b7280' // Label color
                                }
                            },
                            y: {
                                min: 85,
                                max: 100,
                                grid: { 
                                    color: '#e5e7eb', // Lighter grid lines
                                    drawBorder: false // No border on y-axis
                                },
                                ticks: {
                                    callback: function(value) {
                                        return value + '%'; // Add percentage suffix
                                    },
                                    color: '#6b7280'
                                }
                            }
                        }
                    }
                });
            }

            // Risk Chart
            const riskCtx = document.getElementById('riskChart');
            if (riskCtx) {
                // Destroy existing chart if it exists
                if (riskChart) {
                    riskChart.destroy();
                }
                riskChart = new Chart(riskCtx.getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: ['Low Risk', 'Medium Risk', 'High Risk'],
                        datasets: [{
                            data: [65, 28, 7], // Example data
                            backgroundColor: ['#10b981', '#f59e0b', '#ef4444'],
                            borderColor: '#ffffff', // Border between slices
                            borderWidth: 4, // Thicker border
                            hoverOffset: 10 // Pop out effect on hover
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 20,
                                    usePointStyle: true,
                                    font: {
                                        size: 13,
                                        weight: '500'
                                    },
                                    color: '#374151'
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = context.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        if (context.parsed) {
                                            label += context.parsed + '%'; // Assuming data is percentage
                                        }
                                        return label;
                                    }
                                },
                                backgroundColor: 'rgba(0,0,0,0.7)',
                                titleFont: { size: 14, weight: 'bold' },
                                bodyFont: { size: 14 },
                                padding: 10,
                                cornerRadius: 4
                            }
                        },
                        cutout: '60%' // Adjust inner circle size
                    }
                });
            }

            // Throughput Chart
            const throughputCtx = document.getElementById('throughputChart');
            if (throughputCtx) {
                // Destroy existing chart if it exists
                if (throughputChart) {
                    throughputChart.destroy();
                }
                throughputChart = new Chart